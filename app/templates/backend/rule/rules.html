{% extends "backend/common/layout.html" %}
{% block rule_active %}active{% endblock %}
{% block nav_first %}Dashboards{% endblock %}
{% block nav_second %}Rules{% endblock %}
{% block body %}
    <div class="akg ue">
        <div class="akh aki">
            <div class="tn aol">
                <input type="text" class="form-control aqr btn-search-tasks" placeholder="Search rules" value="{{ data.keyword }}">
                <span class="bv adn"></span>
            </div>
        </div>

        <div class="akh">
            <div class="nz">
                <button type="button" class="ce apn add-rule">
                    <span class="bv afg"></span>
                </button>
            </div>
        </div>
    </div>
    <div class="ud">
        <div class="eg">
            <table class="cl" data-sort="table">
                <thead>
                <tr>
                    <th>RID</th>
                    <th>Language</th>
                    <th>Rule type</th>
                    <th>Description</th>
                    <th>Update Time</th>
                    <th>Status</th>
                    <th>Operation</th>
                </tr>
                </thead>
                <tbody>
                {% for rule in data.rules %}
                    <tr>
                        <td data-toggle="modal" data-target="#view-modal" id="tr-rule-{{ rule.id }}">{{ rule.id }}</td>
                        <td data-toggle="modal" data-target="#view-modal" id="tr-rule-{{ rule.id }}">{{ rule.language }}</td>
                        <td data-toggle="modal" data-target="#view-modal" id="tr-rule-{{ rule.id }}">{{ rule.vul_id }}</td>
                        <td data-toggle="modal" data-target="#view-modal" id="tr-rule-{{ rule.id }}">{{ rule.description }}</td>
                        <td data-toggle="modal" data-target="#view-modal" id="tr-rule-{{ rule.id }}">{{ rule.updated_at }}</td>
                        <td align="center" data-toggle="modal" data-target="#view-modal" id="tr-rule-{{ rule.id }}">
                <span style="color: {% if rule.status %}green{% else %}red{% endif %}"
                      class="glyphicon glyphicon-{% if rule.status %}ok{% else %}remove{% endif %}">
                </span>
                        </td>
                        <td hidden id="rule-regex-location-{{ rule.id }}">{{ rule.regex_location }}</td>
                        <td hidden id="rule-regex-repair-{{ rule.id }}">{{ rule.regex_repair }}</td>
                        <td hidden id="rule-block-repair-{{ rule.id }}">{{ rule.block_repair }}</td>
                        <td hidden id="rule-repair-{{ rule.id }}">{{ rule.repair }}</td>
                        <td hidden id="rule-level-{{ rule.id }}">{{ rule.level }}</td>
                        <td>
                            <div class="nz">
                                <button type="button" data-id="{{ rule.id }}" class="ce apn edit-rule">
                                    <span class="bv xk"></span>
                                </button>
                            </div>
                        </td>
                    </tr>
                {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
    <div class="db" id="paginate"></div>
{% endblock %}
{% block scripts %}
    <script>
        $(document).ready(function () {
            // pagination
            make_pagination('{{ data.page }}', 'rules');

            // search
            $(".btn-search-rules").keyup(function (event) {
                if (event.keyCode == 13) {
                    var keyword = $(this).val();
                    if (keyword == "") {
                        alert("keywords can't empty!")
                    } else {
                        window.location.href = "/admin/rules/search/" + keyword;
                    }
                }

            });

            $(".add-rule").click(function () {
                window.location.href = '/admin/rules/add/';
            });

            $('.edit-rule').on('click', function () {
                var pid = $(this).attr('data-id');
                window.location.href = '/admin/rules/edit/' + pid;
            });

        });
    </script>
{% endblock %}